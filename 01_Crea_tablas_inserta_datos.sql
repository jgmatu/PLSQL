-- Script crea tablas e inserta datos:

-- ------------------------------------------------------
-- CREA TABLAS
-- ------------------------------------------------------

-- CLIENTES:
CREATE TABLE CLIENTES (
   ID_CLI INT NOT NULL,
   DNI VARCHAR(9) NOT NULL UNIQUE,
   NOMBRE VARCHAR(15) NOT NULL,
   APES VARCHAR(30) NOT NULL,
   DIR VARCHAR(30) NOT NULL,
   TELF VARCHAR(12),
   USUARIO VARCHAR(10) UNIQUE NOT NULL,
   PASS VARCHAR(10) NOT NULL,
   PRIMARY KEY(ID_CLI)
);

CREATE SEQUENCE SEQCLIENTES INCREMENT BY 1 START WITH 1 NOMAXVALUE;

CREATE OR REPLACE TRIGGER TR_SEQ_CLIENTES before insert on CLIENTES for each row
begin
	select SEQCLIENTES.nextval into :new.ID_CLI from dual;
end;
/

-- ALMACENES:
CREATE TABLE ALMACENES (
   CODALM INT NOT NULL,
   NOMBRE VARCHAR(15) NOT NULL,
   DIR VARCHAR(30) NOT NULL,
   PRIMARY KEY(CODALM)
);

-- CATEGORIAS:
CREATE TABLE CATEGORIAS (
   ID_CAT INT NOT NULL,
   CATEGORIA VARCHAR(15) NOT NULL,
   ALMACEN INT NOT NULL,
   PRIMARY KEY(ID_CAT),
   FOREIGN KEY (ALMACEN) REFERENCES ALMACENES(CODALM)
);

-- PRODUCTOS:
CREATE TABLE PRODUCTOS (
   ID_PROD INT NOT NULL,
   CODPROD INT NOT NULL,
   NOMBRE VARCHAR(15) NOT NULL,
   DESCRIP VARCHAR(100) NOT NULL,
   PVP NUMBER(8,2) NOT NULL,
   UDS_EXISTENCIA INT DEFAULT 0 NOT NULL CHECK (UDS_EXISTENCIA >= 0),
   CATEGORIA INT NOT NULL,
   PRIMARY KEY(ID_PROD),
   FOREIGN KEY (CATEGORIA) REFERENCES CATEGORIAS(ID_CAT)
);

CREATE SEQUENCE SEQPRODUCTOS INCREMENT BY 1 START WITH 1 NOMAXVALUE;

CREATE OR REPLACE TRIGGER TR_SEQ_PRODUCTOS before insert on PRODUCTOS for each row
begin
	select SEQPRODUCTOS.nextval into :new.ID_PROD from dual;
end;
/

-- Indice para NOMBRE de productos
CREATE INDEX I_PROD ON PRODUCTOS(NOMBRE);

-- PEDIDOS:
CREATE TABLE PEDIDOS (
   CODPED INT NOT NULL,
   FECHA DATE NOT NULL,
   FENTREGA DATE,
   ESTADO VARCHAR(9) DEFAULT 'PENDIENTE' NOT NULL,
   IMPORTE NUMBER(8,2) NOT NULL,
   CLIENTE INT NOT NULL,
   PRIMARY KEY (CODPED),
   FOREIGN KEY (CLIENTE) REFERENCES CLIENTES(ID_CLI)
);

-- Secuencia para pedidos:
CREATE SEQUENCE SEQPEDIDOS INCREMENT BY 1 START WITH 1 NOMAXVALUE;

CREATE OR REPLACE TRIGGER TR_SEQ_PEDIDOS before insert on PEDIDOS for each row
begin
	select SEQPEDIDOS.nextval into :new.CODPED from dual;
end;
/

-- DETALLE DE PEDIDO:
CREATE TABLE DETALLE_PEDIDO (
   ID_DP INT NOT NULL,
   PEDIDO INT NOT NULL,
   PRODUCTO INT NOT NULL,
   PRECIO NUMBER(8,2) NOT NULL,
   CANTIDAD INT NOT NULL,
   PRIMARY KEY (ID_DP),
   FOREIGN KEY (PEDIDO) REFERENCES PEDIDOS(CODPED),
   FOREIGN KEY (PRODUCTO) REFERENCES PRODUCTOS(ID_PROD)
);

CREATE SEQUENCE SEQDETPEDIDOS INCREMENT BY 1 START WITH 1 NOMAXVALUE;

CREATE OR REPLACE TRIGGER TR_SEQ_DETPEDIDOS before insert on DETALLE_PEDIDO for each row
begin
	select SEQDETPEDIDOS.nextval into :new.ID_DP from dual;
end;
/

-- ------------------------------------------------------
-- INSERTA DATOS
-- ------------------------------------------------------

-- CLIENTES:
INSERT INTO CLIENTES(DNI,NOMBRE,APES,DIR,USUARIO,PASS) VALUES ('00000','Administrador','del Sistema','ND','admin','4dm1n');
INSERT INTO CLIENTES(DNI,NOMBRE,APES,DIR,TELF,USUARIO,PASS) VALUES ('00001','Pedro','Pérez','Dir1','911111111','pedro','pedro10');
INSERT INTO CLIENTES(DNI,NOMBRE,APES,DIR,TELF,USUARIO,PASS) VALUES ('00010','Marta','García','Dir10','911111112','marta','atram');
INSERT INTO CLIENTES(DNI,NOMBRE,APES,DIR,TELF,USUARIO,PASS) VALUES ('00011','Andrés','Murcia','Dir11','911111113','andres','adrew');
INSERT INTO CLIENTES(DNI,NOMBRE,APES,DIR,TELF,USUARIO,PASS) VALUES ('00100','Adriana','Espí','Dir100','911111114','adri','ana');
INSERT INTO CLIENTES(DNI,NOMBRE,APES,DIR,TELF,USUARIO,PASS) VALUES ('00101','Juan','Luchana','Dir101','911111115','juan','99999');

-- ALMACENES:
INSERT INTO ALMACENES (CODALM,NOMBRE,DIR) VALUES (111,'Warehouse A','Chinchón');
INSERT INTO ALMACENES (CODALM,NOMBRE,DIR) VALUES (222,'Warehouse B','Aranjuez');
INSERT INTO ALMACENES (CODALM,NOMBRE,DIR) VALUES (333,'Warehouse C','Madrid');

-- CATEGORIAS:
INSERT INTO CATEGORIAS (ID_CAT,CATEGORIA,ALMACEN) VALUES (1,'Monitores',111);
INSERT INTO CATEGORIAS (ID_CAT,CATEGORIA,ALMACEN) VALUES (2,'Consumibles',222);
INSERT INTO CATEGORIAS (ID_CAT,CATEGORIA,ALMACEN) VALUES (3,'Impresoras',111);
INSERT INTO CATEGORIAS (ID_CAT,CATEGORIA,ALMACEN) VALUES (4,'Conectividad',333);
INSERT INTO CATEGORIAS (ID_CAT,CATEGORIA,ALMACEN) VALUES (5,'OEM',333);

-- PRODUCTOS:
INSERT INTO PRODUCTOS (CODPROD,NOMBRE,DESCRIP,PVP,UDS_EXISTENCIA,CATEGORIA) VALUES (1001,'ACEM Mod. 1','Monitor TFT 17"',150,5,1);
INSERT INTO PRODUCTOS (CODPROD,NOMBRE,DESCRIP,PVP,UDS_EXISTENCIA,CATEGORIA) VALUES (1002,'ACEM Mod. 2','Monitor TFT 19"',200,5,1);
INSERT INTO PRODUCTOS (CODPROD,NOMBRE,DESCRIP,PVP,UDS_EXISTENCIA,CATEGORIA) VALUES (2001,'Tinta Roja','Cartucho compatible Mepson rojo',10,50,2);
INSERT INTO PRODUCTOS (CODPROD,NOMBRE,DESCRIP,PVP,UDS_EXISTENCIA,CATEGORIA) VALUES (2002,'Tinta Amarilla','Cartucho compatible Mepson amarillo',10,50,2);
INSERT INTO PRODUCTOS (CODPROD,NOMBRE,DESCRIP,PVP,UDS_EXISTENCIA,CATEGORIA) VALUES (2003,'Tinta Azul','Cartucho compatible Mepson azul',10,50,2);
INSERT INTO PRODUCTOS (CODPROD,NOMBRE,DESCRIP,PVP,UDS_EXISTENCIA,CATEGORIA) VALUES (2004,'Tinta Negra','Cartucho compatible Mepson negro',8,50,2);
INSERT INTO PRODUCTOS (CODPROD,NOMBRE,DESCRIP,PVP,UDS_EXISTENCIA,CATEGORIA) VALUES (3001,'Mepson 980i','Impresora Mepson multifunción',125.50,4,3);
INSERT INTO PRODUCTOS (CODPROD,NOMBRE,DESCRIP,PVP,UDS_EXISTENCIA,CATEGORIA) VALUES (3002,'TacheP 4000n','Impresora TacheP con red',315,2,3);
INSERT INTO PRODUCTOS (CODPROD,NOMBRE,DESCRIP,PVP,UDS_EXISTENCIA,CATEGORIA) VALUES (4001,'Switch Monexant','Switch 24 puertos, acceso web',255,4,4);
INSERT INTO PRODUCTOS (CODPROD,NOMBRE,DESCRIP,PVP,UDS_EXISTENCIA,CATEGORIA) VALUES (5001,'DVD-RW LJ','DVD-RW doble capa',20,25,5);

-- PEDIDOS:
INSERT INTO PEDIDOS (FECHA,FENTREGA,ESTADO,IMPORTE,CLIENTE) VALUES (TO_DATE('2007-11-02','YYYY-MM-DD'),TO_DATE('2007-11-17','YYYY-MM-DD'),'ENTREGADO',525.5,3);
INSERT INTO PEDIDOS (FECHA,FENTREGA,ESTADO,IMPORTE,CLIENTE) VALUES (TO_DATE('2008-02-26','YYYY-MM-DD'),TO_DATE('2008-03-05','YYYY-MM-DD'),'RUTA',4000,2);
INSERT INTO PEDIDOS (FECHA,FENTREGA,ESTADO,IMPORTE,CLIENTE) VALUES (TO_DATE('2008-03-03','YYYY-MM-DD'),TO_DATE('2008-03-18','YYYY-MM-DD'),'RUTA',3600,6);

-- DETALLE PEDIDOS:
INSERT INTO DETALLE_PEDIDO (PEDIDO,PRODUCTO,PRECIO,CANTIDAD) VALUES (1,1,150,2);
INSERT INTO DETALLE_PEDIDO (PEDIDO,PRODUCTO,PRECIO,CANTIDAD) VALUES (1,7,125.5,1);
INSERT INTO DETALLE_PEDIDO (PEDIDO,PRODUCTO,PRECIO,CANTIDAD) VALUES (1,10,20,5);

INSERT INTO DETALLE_PEDIDO (PEDIDO,PRODUCTO,PRECIO,CANTIDAD) VALUES (2,2,200,20);

INSERT INTO DETALLE_PEDIDO (PEDIDO,PRODUCTO,PRECIO,CANTIDAD) VALUES (3,3,10,100);
INSERT INTO DETALLE_PEDIDO (PEDIDO,PRODUCTO,PRECIO,CANTIDAD) VALUES (3,4,10,100);
INSERT INTO DETALLE_PEDIDO (PEDIDO,PRODUCTO,PRECIO,CANTIDAD) VALUES (3,5,10,100);
INSERT INTO DETALLE_PEDIDO (PEDIDO,PRODUCTO,PRECIO,CANTIDAD) VALUES (3,6,6,100);
